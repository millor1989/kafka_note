### 生产者

#### 1、负载均衡

生产者直接发送数据到对应分区的leader所在的代理，不需要经过任何中间路由层。为了帮助生产者，Kafka节点可以在任何指定时间回答关于哪个服务器活跃以及主题分区的leaders在哪里的元数据请求，从而让生产者可以适当地引导它的请求。

客户端控制着它向哪个分区发布消息。这可以以随机、实现一种随机负载均衡、或者通过某些语义分区函数的方式实现。通过允许用户指定一个分区key，并且使用这个key来哈希到一个分区（如果需要，还有一个覆盖分区函数的选项），Kafka暴露了分区语义接口。例如，如果key是用户ID，那么所有指定用户的数据会被发送到相同的分区。这反过来可以让消费者进行它们消费的本地性假设。这种分区风格被明确地设计为允许消费者进行本地性敏感的处理。

#### 2、异步发送

分批是高效性的一个大驱动，为了支持分区Kafka生产者会尝试把数据累积到内存中，并在一个请求中发出更大的批次。分批可以被配置为累积不超过一个指定量的消息并且等待不超过某个固定的延时边界（比如64kb，10ms）。这使得可以累积更多要发送的字节，和服务器上很少的更大的I/O操作。这种缓冲是可以配置的，并且提供了一种以少量的延时获取更好的吞吐量的权衡机制。